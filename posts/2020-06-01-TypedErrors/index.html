<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Typed Errors — Daniel Winograd-Cort</title>
    
    <meta name="keywords" content="haskell, row-types, errors, native">

    <link rel="shortcut icon" type="image/x-icon" href="../../images/haskell-logo.png?format=100w" />  <!-- href="/favicon.ico?format=100w" -->
    <link rel="canonical" href="http://www.danwc.com" />
    <meta property="og:site_name" content="Daniel Winograd‑Cort" />
    <meta property="og:title" content="Typed Errors — Daniel Winograd-Cort" />
    <meta property="og:url" content="https://danwc.com/posts/2020-06-01-TypedErrors/index.html" />
    <meta property="og:type" content="website" />
    <meta itemprop="name" content="Typed Errors — Daniel Winograd-Cort" />
    <meta itemprop="url" content="https://danwc.com/posts/2020-06-01-TypedErrors/index.html" />
    <meta name="twitter:title" content="Daniel Winograd‑Cort" />
    <meta name="twitter:url" content="https://danwc.com/posts/2020-06-01-TypedErrors/index.html" />
    <meta name="twitter:card" content="summary" />
    <meta name="description" content />

    <link rel="stylesheet" href="../../css/default.css" />
  </head>
  <body>
    <header>
      <div class="site-title">
        <h1 class="site-title site-title">
          <a href="../../" title="Daniel Winograd‑Cort">
            <span>Daniel Winograd‑Cort</span>
          </a>
        </h1>
      </div>
      <div class="site-description">
        <p>Senior Software Engineer at Luminous Computing</p>
      </div>

      <nav>
        <a href="../../posts">Posts</a>
        <a href="../../research">Research</a>
        <a href="../../projects">Projects</a>
        <a href="../../teaching">Teaching</a>
        <a href="../../data/danwc-resume.pdf" target="_blank">Resume</a>
        <a href="../../personal">Personal</a>
        <a href="../../contact">Contact</a>
      </nav>
    </header>

    <main role="main">
      <article>
    <section class="header">
        
        Re-posted on June  1, 2020 (originally written April 8, 2019)
        
    </section>
    <section>
        <link rel="stylesheet" href="../../css/syntax.css" />
        <h1 id="typed-errors">Typed Errors</h1>
<p>I read a post by Matt Parsons called <a href="https://www.parsonsmatt.org/2018/11/03/trouble_with_typed_errors.html">The Trouble with Typed Errors</a> that talks about the difficulties we face in Haskell from not having open variant types. Matt says:</p>
<blockquote>
<p>Haskell doesn’t have open variants, and the attempts to mock them end up quite clumsy to use in practice.</p>
</blockquote>
<p>But, I disagree. I think row-types handles the typed error case quite nicely.</p>
<h2 id="imports">Imports</h2>
<p>As this is a Literate Haskell file, let’s get the imports and pragmas out of the way first…</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"><span class="ot">{-# LANGUAGE AllowAmbiguousTypes #-}</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="ot">{-# LANGUAGE DataKinds #-}</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="ot">{-# LANGUAGE OverloadedLabels #-}</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="ot">{-# LANGUAGE ScopedTypeVariables #-}</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="ot">{-# LANGUAGE TypeOperators #-}</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">module</span> <span class="dt">TypedErrors</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">import</span> <span class="dt">Data.Row</span></a></code></pre></div>
<h2 id="example">Example</h2>
<p>I’ll try to set up the situation similar to how Matt sets it up in his blog. Let’s start with two functions, <code>foo</code> and <code>bar</code>, that may each fail.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">data</span> <span class="dt">FooErr</span> <span class="fu">=</span> <span class="dt">FooErr</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="kw">deriving</span> (<span class="dt">Show</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">data</span> <span class="dt">BarErr</span> <span class="fu">=</span> <span class="dt">BarErr</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="kw">deriving</span> (<span class="dt">Show</span>)</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="ot">foo ::</span> <span class="dt">Either</span> <span class="dt">FooErr</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb2-8" title="8">foo <span class="fu">=</span> <span class="dt">Left</span> (<span class="dt">FooErr</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="ot">bar ::</span> <span class="dt">Either</span> <span class="dt">BarErr</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb2-11" title="11">bar <span class="fu">=</span> <span class="dt">Left</span> (<span class="dt">BarErr</span> <span class="st">&quot;Oops&quot;</span>)</a></code></pre></div>
<p>Of course, the problem with this code is that there’s no good way to deal with these two errors together. Matt explains in his blog the various problems, but in short:</p>
<ul>
<li><p>As is, <code>foo</code> and <code>bar</code> aren’t in the same monad (because they have different error types!), so we cannot use do notation.</p></li>
<li><p>If we group the errors into something like <code>Either FooErr BarErr</code>, then not only must we be very diligent about <code>Left</code>s and <code>Right</code>s (especially if we add more error types), but we run into issues because <code>Either FooErr BarErr</code> ≠ <code>Either BarErr FooErr</code>.</p></li>
<li><p>If we combine the errors into one monolithic error type, we lose static guarantees about exactly which errors a function may produce and exactly which we are handling when we write error handlers.</p></li>
</ul>
<h2 id="a-row-types-solution">A row-types solution</h2>
<h3 id="generating-errors">Generating Errors</h3>
<p>With row-types, we have open variants easily available to us, which means we can do the following:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1"><span class="ot">foo ::</span> (<span class="dt">AllUniqueLabels</span> r, r <span class="fu">.!</span> <span class="st">&quot;fooErr&quot;</span> ≈ <span class="dt">Int</span>)    <span class="ot">=&gt;</span> <span class="dt">Either</span> (<span class="dt">Var</span> r) <span class="dt">Int</span></a>
<a class="sourceLine" id="cb3-2" title="2">foo <span class="fu">=</span> <span class="dt">Left</span> (<span class="dt">IsJust</span> <span class="fu">#</span>fooErr <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="ot">bar ::</span> (<span class="dt">AllUniqueLabels</span> r, r <span class="fu">.!</span> <span class="st">&quot;barErr&quot;</span> ≈ <span class="dt">String</span>) <span class="ot">=&gt;</span> <span class="dt">Either</span> (<span class="dt">Var</span> r) <span class="dt">Int</span></a>
<a class="sourceLine" id="cb3-5" title="5">bar <span class="fu">=</span> <span class="dt">Left</span> (<span class="dt">IsJust</span> <span class="fu">#</span>barErr <span class="st">&quot;Oops&quot;</span>)</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="ot">baz ::</span> (<span class="dt">AllUniqueLabels</span> r, r <span class="fu">.!</span> <span class="st">&quot;bazErr&quot;</span> ≈ <span class="dt">Bool</span>)   <span class="ot">=&gt;</span> <span class="dt">Either</span> (<span class="dt">Var</span> r) <span class="dt">Int</span></a>
<a class="sourceLine" id="cb3-8" title="8">baz <span class="fu">=</span> <span class="dt">Left</span> (<span class="dt">IsJust</span> <span class="fu">#</span>bazErr <span class="dt">True</span>)</a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10"></a>
<a class="sourceLine" id="cb3-11" title="11">foobarbaz</a>
<a class="sourceLine" id="cb3-12" title="12"><span class="ot">  ::</span> ( <span class="dt">AllUniqueLabels</span> r</a>
<a class="sourceLine" id="cb3-13" title="13">     , r <span class="fu">.!</span> <span class="st">&quot;fooErr&quot;</span> ≈ <span class="dt">Int</span></a>
<a class="sourceLine" id="cb3-14" title="14">     , r <span class="fu">.!</span> <span class="st">&quot;barErr&quot;</span> ≈ <span class="dt">String</span></a>
<a class="sourceLine" id="cb3-15" title="15">     , r <span class="fu">.!</span> <span class="st">&quot;bazErr&quot;</span> ≈ <span class="dt">Bool</span>)</a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="ot">=&gt;</span> <span class="dt">Either</span> (<span class="dt">Var</span> r) <span class="dt">Int</span></a>
<a class="sourceLine" id="cb3-17" title="17">foobarbaz <span class="fu">=</span> bar <span class="fu">*&gt;</span> foo <span class="fu">*&gt;</span> bar <span class="fu">*&gt;</span> baz</a></code></pre></div>
<p>In <code>foo</code>, we create error data with the expression <code>IsJust #fooErr 3</code>. This creates a new row-types variant at the label <code>"fooErr"</code> with the value <code>3</code>. The context indicates that the error type may have other possibilities: specifically, <code>AllUniqueLabels r</code> is some boilerplate that guarantees that no two possibilities have the same name, and <code>r .! "fooErr" ≈ Int</code> declares that the <code>fooErr</code> possibility has a payload of type <code>Int</code>.</p>
<p>We can do the same for <code>bar</code>/<code>barErr</code> and <code>baz</code>/<code>bazErr</code>, and then if we want to compose them together, we can easily do so as in <code>foobarbaz</code>. Furthermore, although we provide the type signatures here, GHC will infer them just fine (with <code>NoMonomorphismRestriction</code>).</p>
<h3 id="handling-errors">Handling Errors</h3>
<p>We can handle these errors in multiple ways.</p>
<p>First off, it’s easy enough to <code>show</code> our value (so long as the data in the errors is <code>Show</code>able):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1"><span class="ot">printFoobarbaz ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb4-2" title="2">printFoobarbaz <span class="fu">=</span> <span class="fu">show</span> specificFoobarbaz</a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="kw">where</span><span class="ot"> specificFoobarbaz ::</span> <span class="dt">Either</span> (<span class="dt">Var</span> (<span class="st">&quot;fooErr&quot;</span> <span class="fu">.==</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb4-4" title="4">                                       <span class="fu">.+</span> <span class="st">&quot;barErr&quot;</span> <span class="fu">.==</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb4-5" title="5">                                       <span class="fu">.+</span> <span class="st">&quot;bazErr&quot;</span> <span class="fu">.==</span> <span class="dt">Bool</span>)) <span class="dt">Int</span></a>
<a class="sourceLine" id="cb4-6" title="6">        specificFoobarbaz <span class="fu">=</span> foobarbaz</a></code></pre></div>
<p>All row-types variants implement an obvious <code>Show</code> instance, but do note that to <code>show</code> <code>foobarbaz</code>, we must specify its type. This is because <code>foobarbaz</code> is defined polymorphically over any variant that has appropriate entries for <code>fooErr</code>, <code>barErr</code>, and <code>bazErr</code>, but to <code>show</code> it, we must pick a concrete type to use for the <code>Show</code> instance. In this case, we pick the minimum variant.</p>
<p>We can also deal with a single error at a time using the <code>trial</code> function. This function lets us pluck a particular possibility out of a variant, allowing us to handle that possibility or be left with the leftovers of the variant. In the following case, we handle the <code>fooErr</code> possibility, using the <code>Int</code> value it contains as our return value. If <code>foobarbaz</code> is not a <code>fooErr</code>, then we’re left with a <code>Left</code> error value that cannot be a <code>fooErr</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1"><span class="ot">handleFoo ::</span> <span class="kw">forall</span> r<span class="fu">.</span></a>
<a class="sourceLine" id="cb5-2" title="2">  ( <span class="dt">AllUniqueLabels</span> r</a>
<a class="sourceLine" id="cb5-3" title="3">  , r <span class="fu">.!</span> <span class="st">&quot;fooErr&quot;</span> ≈ <span class="dt">Int</span></a>
<a class="sourceLine" id="cb5-4" title="4">  , r <span class="fu">.!</span> <span class="st">&quot;barErr&quot;</span> ≈ <span class="dt">String</span></a>
<a class="sourceLine" id="cb5-5" title="5">  , r <span class="fu">.!</span> <span class="st">&quot;bazErr&quot;</span> ≈ <span class="dt">Bool</span>)</a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="ot">=&gt;</span> <span class="dt">Either</span> (<span class="dt">Var</span> (r <span class="fu">.-</span> <span class="st">&quot;fooErr&quot;</span>)) <span class="dt">Int</span></a>
<a class="sourceLine" id="cb5-7" title="7">handleFoo <span class="fu">=</span></a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="kw">case</span> foobarbaz <span class="kw">of</span></a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="dt">Left</span> err  <span class="ot">-&gt;</span> <span class="kw">case</span> trial <span class="fu">@</span>_ <span class="fu">@</span>r err <span class="fu">#</span>fooErr <span class="kw">of</span></a>
<a class="sourceLine" id="cb5-10" title="10">      <span class="dt">Left</span>  i     <span class="ot">-&gt;</span> <span class="dt">Right</span> i</a>
<a class="sourceLine" id="cb5-11" title="11">      <span class="dt">Right</span> other <span class="ot">-&gt;</span> <span class="dt">Left</span> other</a>
<a class="sourceLine" id="cb5-12" title="12">    <span class="dt">Right</span> i   <span class="ot">-&gt;</span> <span class="dt">Right</span> i</a></code></pre></div>
<p>The type signature of <code>handleFoo</code> is a little disappointing but necessary because we’re keeping our variant type entirely polymorphic. However, if we were willing to monomorphize our error to a concrete type, the constraints (and the type applications on <code>trial</code>) would no longer be necessary. This is a tradeoff that one needs to make based on the situation.</p>
<p>Finally, we have the option of handling all errors at once using <code>switch</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" title="1"><span class="ot">handleAll ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb6-2" title="2">handleAll <span class="fu">=</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="kw">case</span> foobarbaz <span class="kw">of</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="dt">Left</span> err <span class="ot">-&gt;</span> switch err <span class="fu">$</span></a>
<a class="sourceLine" id="cb6-5" title="5">         <span class="fu">#</span>fooErr <span class="fu">.==</span> (\n <span class="ot">-&gt;</span> <span class="st">&quot;FooErr of &quot;</span> <span class="fu">++</span> <span class="fu">show</span> n)</a>
<a class="sourceLine" id="cb6-6" title="6">      <span class="fu">.+</span> <span class="fu">#</span>barErr <span class="fu">.==</span> (\s <span class="ot">-&gt;</span> <span class="st">&quot;BarErr of &quot;</span> <span class="fu">++</span> s)</a>
<a class="sourceLine" id="cb6-7" title="7">      <span class="fu">.+</span> <span class="fu">#</span>bazErr <span class="fu">.==</span> (\b <span class="ot">-&gt;</span> <span class="st">&quot;BazErr of &quot;</span> <span class="fu">++</span> <span class="fu">show</span> b)</a>
<a class="sourceLine" id="cb6-8" title="8">    <span class="dt">Right</span> i  <span class="ot">-&gt;</span> <span class="st">&quot;Got the result &quot;</span> <span class="fu">&lt;&gt;</span> <span class="fu">show</span> i</a></code></pre></div>
<p>Specifically, <code>switch</code> allows us to define a case for every possibility of a variant, allowing us to reduce the variant to an ordinary result. In this case, type annotations are not needed because the variant must match exactly the form of the <code>switch</code>’s cases. Because we have exactly 3 cases, one for each of our errors, GHC monomorphizes the error component of <code>foobarbaz</code> to <code>Var ("fooErr" .== Int .+ "barErr" .== String .+ "bazErr" .== Bool)</code> automatically.</p>
<h2 id="achievements-and-limitations">Achievements and Limitations</h2>
<p>Using variants, we are able to create and handle typed errors without dealing with weird nesting of <code>Either</code>s and without losing any static guarantees. Furthermore, variant typed errors can be easily defined with constraints (as we did here with the constraints like <code>r .! "fooErr" ≈ Int</code>) with minimal boilerplate: no extra data declarations necessary! And, once monomorphized, two variants with the same possibilities always share the same type, regardless of the order that the possibilities are described in the type. I also didn’t discuss <code>diversify</code>, which allows one to expand the possibilities in a variant, which, for typed errors, allows one to use a limited (perhaps already monomorphized) error type in a more general setting.</p>
<p>However, there are downsides to variants typed errors. A little bit of boilerplate does remain in the form of the <code>AllUniqueLabels</code> constraint, which just about always needs to be used. Also, GHC has trouble inferring all the types and constraints when we want to remain as polymorphic as possible, which means writing out some annoying types and occasionally using type annotations (as seen in <code>handleFoo</code> above). Lastly, the <code>switch</code> expression seems a lot like an ordinary Haskell <code>case</code> expression, but it isn’t, which means the user is forced to learn what amounts to a special syntax just for dispatching the errors.</p>
<p>There are specific considerations for any project, but I think row-types variants are a great choice for typed errors.</p>
    </section>
</article>

    </main>

    <footer>
      <quote>
        <blockquote data-animation-role="quote">
          quotetext
        </blockquote>
        <figcaption class="source">&mdash; quoteattrib</figcaption>
      </quote>
      <p> Site generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
    </footer>

  <script>
    var myQs = new Array();
    myQs[0] = "Real stupidity beats artificial intelligence every time. -- Terry Pratchett";
    myQs[1] = "He who wonders discovers that this in itself is wonder. -- M. C. Escher";
    myQs[2] = "Simplicity is the ultimate sophistication. -- Leonardo da Vinci";
    myQs[3] = "Time is like a drug. Too much of it kills you. -- Terry Pratchett";
    myQs[4] = "When it came to getting weird things done, sane beat mad hands down. -- Terry Pratchett";
    myQs[5] = "Students, eh? Love 'em or hate 'em, you're not allowed to hit 'em with a shovel. -- Terry Pratchett";
    myQs[6] = "You get ideas from daydreaming. You get ideas from being bored. You get ideas all the time. -- Neil Gaiman";
    myQs[7] = "I don't know half of you half as well as I should like; and I like less than half of you half as well as you deserve. -- Bilbo Baggins, from J.R.R Tolkien's Lord of the Rings";
    myQs[8] = "Only the insane equate pain with success. -- Cheshire Cat, from American Mcgee's Alice";
    myQs[9] = "Only a few find the way; some don't recognize it when they do; some don't ever want to. -- Cheshire Cat, from American Mcgee's Alice";
    myQs[10] = "Always collect what's useful. Reject only your ignorance, and you may survive. -- Cheshire Cat, from American Mcgee's Alice";
    myQs[11] = "Those who say there's nothing like a nice cup of tea for calming the nerves never had real tea. It's like a syringe of adrenaline straight to the heart! -- Cheshire Cat, from American Mcgee's Alice";
    myQs[12] = "My, Earth really is full of things -- King of All Cosmos, from Katamari Damacy";
    myQs[13] = "The way I see it, if you're going to build a time machine into a car, why not do it with some style? -- Doc, from Back to the Future";
    myQs[14] = "I know because I was there. -- Wadsworth, from Clue";
    myQs[15] = "No meaning yes, or no meaning no? -- Colonel Mustard, from Clue";
    myQs[16] = "I feel like I could... like I could... like I could... TAKE ON THE WORLD!! -- Purple Tentacle, from Day of the Tentacle";
    myQs[17] = "You know what they say: \"If you want to save the world, you have to push a few old ladies down the stairs\". -- Bernard, from Day of the Tentacle";
    myQs[18] = "Wait, I’ve got an idea, and it doesn’t require high explosives. -- Max, from Sam'n'Max Hit the Road";
    myQs[19] = "You have this really convenient subspace highway running through your head that I like to use. It's, like, 3 miles in 15 seconds. -- Ramona, from Scott Pilgrim vs The World";
    myQs[20] = "Do you think that's air you're breathing now?  Stop trying to hit me and hit me! -- Morpheus, from The Matrix";
    myQs[21] = "Ray, when someone asks you if you're a god, you say \"Yes!\" -- Winston, from Ghostbusters";
    myQs[22] = "So, Lone Starr, now you see that evil will always triumph, because good is dumb. -- Dark Helmet, from Spaceballs";
    myQs[23] = "People assume that time is a strict progression of cause to effect, but actually — from a non-linear, non-subjective viewpoint — it's more like a big ball of wibbly-wobbly... timey-wimey... stuff. -- Doctor Who";
    myQs[24] = "I must not fear. Fear is the mind-killer. Fear is the little-death that brings total obliteration. -- Paul Atreides, from Frank Herbert's Dune";
    myQs[25] = "Science fiction writers foresee the inevitable, and although problems and catastrophes may be inevitable, solutions are not. -- Isaac Asimov";
    myQs[26] = "To succeed, planning alone is insufficient. One must improvise as well. -- Isaac Asimov";
    myQs[27] = "Remember - the enemy's gate is down. -- Ender, from Orson Scott Card's Ender's Game";
    myQs[28] = "Space is big. Really big. You just won't believe how vastly, hugely, mindbogglingly big it is. I mean, you may think it's a long way down the road to the chemist's, but that's just peanuts to space. -- Douglas Adams, The Hitchhiker's Guide to the Galaxy";
    myQs[29] = "The chances of finding out what's really going on in the universe are so remote, the only thing to do is hang the sense of it and keep yourself occupied. -- Douglas Adams, The Hitchhiker's Guide to the Galaxy";
    myQs[30] = "Hey, you sass that hoopy Ford Prefect? There's a frood who really knows where his towel is. -- Douglas Adams, The Hitchhiker's Guide to the Galaxy";
    myQs[31] = "There's always money in the banana stand. -- George Bluth, from Arrested Development";
    myQs[32] = "Introducing \"the double decker couch\", so everyone could watch TV together and be buddies! -- Emmet, from The Lego Movie";
    myQs[33] = "Ah! Curse your sudden but inevitable betrayal! -- Wash, from Firefly";
    myQs[34] = "Nothing can happen till you swing the bat. -- Haruko, from FLCL";
    myQs[35] = "Dear God. What is it like in your funny little brains? It must be so boring. -- Sherlock";
    myQs[36] = "You, [subject name here], must be the pride of [subject hometown here]! -- GLaDOS, from Portal";
    myQs[37] = "Please note that we have added a consequence for failure. Any contact with the chamber floor will result in an \"unsatisfactory\" mark on your official testing record, followed by death. Good luck! -- GLaDOS, from Portal";
    myQs[38] = "Did you know you can donate one or all of your vital organs to the Aperture Science Self-Esteem Fund for Girls? It's true! -- GLaDOS, from Portal";
    myQs[39] = "You euthanized your faithful Companion Cube more quickly than any test subject on record. Congratulations. -- GLaDOS, from Portal";
    myQs[40] = "Look at me still talking when there's Science to do -- GLaDOS, from Portal";
    myQs[41] = "The Human Mind: 600 miles of synaptic fiber, five and a half ounces of cranial fluid, 1500 grams of complex neural matter... a three-pound pile of dreams. -- Raz, from Psychonauts";


    var range = myQs.length;
    var index;
    var quote;
    var res;
    var attribution;
    var bodyGrab;

    function getQuote()
    {
      index = Math.floor(Math.random()*range);
      quote = myQs[index];
      res = quote.split(" -- ");
      quote = res[0];
      attribution = res[1];
    }

    var blocks = document.getElementsByTagName("blockquote");
    var captions = document.getElementsByTagName("figcaption");
    for (var i=0;i<blocks.length;i++)
    {
      getQuote();
      bodyGrab = blocks[i].innerHTML;
      bodyGrab = bodyGrab.replace("quotetext", quote);
      blocks[i].innerHTML = bodyGrab;
      bodyGrab = captions[i].innerHTML;
      bodyGrab = bodyGrab.replace("quoteattrib", attribution);
      captions[i].innerHTML = bodyGrab;
    }
  </script>
  </body>
</html>
